## user
How can I use dracut to create a link to kernel after install
## assistant

To create a symbolic link to a kernel after installing it using Dracut, you can follow these steps:

1. **Install the Kernel and Dracut (if not installed):**
   Ensure you have the kernel and Dracut installed on your system. You can install them using your package manager:

   ```bash
   sudo dnf install kernel dracut
   ```

   Replace `dnf` with your package manager, e.g., `apt` for Debian/Ubuntu or `pacman` for Arch Linux.

2. **Create the Initial RAM Disk (initramfs) using Dracut:**
   Dracut is used to generate the initramfs, which is essential for booting the kernel. The following command creates an initramfs for a specific kernel version:

   ```bash
   sudo dracut --force /boot/initramfs-<kernel_version>.img <kernel_version>
   ```

   Replace `<kernel_version>` with the version of the kernel you have installed. For example:

   ```bash
   sudo dracut --force /boot/initramfs-5.15.0-76-generic.img 5.15.0-76-generic
   ```

3. **Create the Symbolic Link to the Kernel:**
   After generating the initramfs, you can create a symbolic link to the kernel:

   ```bash
   sudo ln -s /boot/vmlinuz-<kernel_version> /boot/vmlinuz
   ```

   Replace `<kernel_version>` with your installed kernel version. For example:

   ```bash
   sudo ln -s /boot/vmlinuz-5.15.0-76-generic /boot/vmlinuz
   ```

   This command creates a symbolic link named `vmlinuz` in the `/boot` directory, pointing to the specified kernel version.

4. **Update the Bootloader:**
   After creating the initramfs and linking the kernel, it's important to update your bootloader (e.g., GRUB) to ensure the new kernel is recognized. For GRUB, you can update it using:

   ```bash
   sudo grub2-mkconfig -o /boot/grub2/grub.cfg
   ```

   Or for systems using EFI:

   ```bash
   sudo grub2-mkconfig -o /boot/efi/EFI/<distribution>/grub.cfg
   ```

   Replace `<distribution>` with your Linux distribution name (e.g., `fedora`, `ubuntu`).

After completing these steps, your system should be set up to boot with the newly installed kernel using the initramfs generated by Dracut, and the symbolic link will point to the correct kernel version.
## user
How can I use dracut to create a link to kernel after every kernel update 
## assistant

To automatically create a link to the kernel using `dracut` after every kernel update, you can follow these steps:

1. **Create a Dracut Configuration File**:

   You'll need to create or modify a dracut configuration file. Dracut uses configuration files located in `/etc/dracut.conf.d/`. You can create a custom configuration file like this:

   ```bash
   sudo nano /etc/dracut.conf.d/10-link-kernel.conf
   ```

2. **Add the Custom Script to the Configuration File**:

   Add the following content to the file:

   ```bash
   install_items+=" /path/to/custom/script.sh "
   ```

   Replace `/path/to/custom/script.sh` with the path to the script that creates the symlink to your kernel.

3. **Create the Custom Script**:

   You need a custom script that `dracut` will run during the initramfs creation process to create the symlink. Here’s an example script:

   ```bash
   #!/bin/bash

   KERNEL_VERSION=$(uname -r)
   ln -sf /boot/vmlinuz-$KERNEL_VERSION /boot/vmlinuz-link
   ```

   Save this script somewhere, for example `/usr/local/bin/create-kernel-link.sh`, and make it executable:

   ```bash
   sudo chmod +x /usr/local/bin/create-kernel-link.sh
   ```

4. **Ensure Dracut Runs the Script**:

   By adding the script to the `install_items` in the dracut configuration file, it will be included in the initramfs, and `dracut` will execute it during the initramfs generation process.

5. **Update the Initramfs**:

   Whenever there’s a kernel update, the `dracut` process will run and create the symbolic link automatically due to the script being called.

### Optional: Test the Setup
After setting this up, you can test it by regenerating the initramfs for the current kernel to see if the symlink gets created:

```bash
sudo dracut --force
```

This setup ensures that every time you update the kernel, a symbolic link to the kernel image is created automatically.

Let me know if you need further clarification!